<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Subir nueva app - My Store</title>
  <link rel="stylesheet" href="styles-upload.css" />
  <style>
    /* === Mejoras visuales === */
    .preview-container {
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 15px 0;
    }
    .preview-container img {
      max-width: 160px;
      border-radius: 12px;
      box-shadow: 0 0 12px rgba(0,0,0,0.2);
      display: none;
      transition: opacity 0.4s ease;
    }
    .progress {
      width: 100%;
      height: 8px;
      background: rgba(255,255,255,0.15);
      border-radius: 6px;
      overflow: hidden;
      margin-top: 10px;
    }
    #progressBar {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, #00c6ff, #0072ff);
      transition: width 0.4s ease;
    }
    #statusMessage {
      text-align: center;
      margin-top: 12px;
      font-weight: 600;
      font-size: 0.95rem;
    }
    #statusMessage.success {
      color: #5af57a;
    }
    #statusMessage.error {
      color: #ff6b6b;
    }
  </style>
</head>
<body>
  <!-- üåà Fondo animado -->
  <div class="bubble" style="left: 10%; width: 60px; height: 60px; animation-delay: 0s;"></div>
  <div class="bubble" style="left: 30%; width: 40px; height: 40px; animation-delay: 2s;"></div>
  <div class="bubble" style="left: 50%; width: 80px; height: 80px; animation-delay: 4s;"></div>
  <div class="bubble" style="left: 70%; width: 50px; height: 50px; animation-delay: 6s;"></div>
  <div class="bubble" style="left: 90%; width: 70px; height: 70px; animation-delay: 8s;"></div>

  <!-- üåÄ Splash screen -->
  <div class="splash-screen">
    <img src="logo.png" alt="My Store Logo" class="splash-logo" />
    <div class="splash-text">Preparando formulario...</div>
  </div>

  <!-- ‚öôÔ∏è P√°gina principal -->
  <div class="upload-container">
    <header>
      <div class="header-content">
        <img src="logo.png" alt="My Store Logo" class="header-logo" />
        <h1>Subir nueva app</h1>
      </div>
      <button class="back-btn" onclick="goBack()">‚Üê Volver al Panel</button>
    </header>

    <form id="uploadForm" enctype="multipart/form-data">
      <label for="name">Nombre de la app</label>
      <input type="text" id="name" name="name" placeholder="Ejemplo: Calculadora Pro" required />

      <label for="description">Descripci√≥n</label>
      <textarea id="description" name="description" placeholder="Describe brevemente la aplicaci√≥n..." rows="4" required></textarea>

      <label for="image">Imagen de la app (JPG o PNG)</label>
      <input type="file" id="image" name="image" accept="image/*" required />
      <div class="preview-container">
        <img id="preview" alt="Vista previa" />
      </div>

      <label for="apk">Archivo APK</label>
      <input type="file" id="apk" name="apk" accept=".apk" required />

      <button type="submit" id="uploadBtn">üöÄ Subir aplicaci√≥n</button>

      <div class="progress">
        <div id="progressBar"></div>
      </div>

      <div id="statusMessage"></div>
    </form>
  </div>

  <script>
    // üåà Efecto volver
    function goBack() {
      document.body.classList.add("page-transition");
      setTimeout(() => (window.location.href = "admin.html"), 700);
    }

    // üñºÔ∏è Vista previa de imagen
    const imageInput = document.getElementById("image");
    const preview = document.getElementById("preview");
    imageInput.addEventListener("change", () => {
      const file = imageInput.files[0];
      if (file) {
        preview.src = URL.createObjectURL(file);
        preview.style.display = "block";
        preview.style.opacity = "1";
      } else {
        preview.style.display = "none";
      }
    });

    // üöÄ Subir app con progreso
    const form = document.getElementById("uploadForm");
    const progressBar = document.getElementById("progressBar");
    const statusMessage = document.getElementById("statusMessage");

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      const formData = new FormData(form);

      progressBar.style.width = "0%";
      statusMessage.innerHTML = "üì§ Subiendo archivos...";
      statusMessage.className = "";

      const xhr = new XMLHttpRequest();
      xhr.open("POST", "/upload", true);

      xhr.upload.onprogress = function (e) {
        if (e.lengthComputable) {
          const percent = (e.loaded / e.total) * 100;
          progressBar.style.width = percent + "%";
        }
      };

      xhr.onload = function () {
        if (xhr.status === 200) {
          statusMessage.innerHTML = "‚úÖ Aplicaci√≥n subida con √©xito.";
          statusMessage.className = "success";
          progressBar.style.width = "100%";
          form.reset();
          preview.style.display = "none";
        } else {
          statusMessage.innerHTML = "‚ùå Error al subir la aplicaci√≥n.";
          statusMessage.className = "error";
        }
      };

      xhr.onerror = function () {
        statusMessage.innerHTML = "‚ö†Ô∏è Error de conexi√≥n.";
        statusMessage.className = "error";
      };

      xhr.send(formData);
    });
  </script>
</body>
</html>
